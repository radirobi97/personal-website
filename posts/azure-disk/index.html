<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Robert Radi"><meta name=description content="This article gives an in-depth guide to Azure Managed Disks."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Everything you should know about Azure Managed Disks"><meta name=twitter:description content="This article gives an in-depth guide to Azure Managed Disks."><meta property="og:title" content="Everything you should know about Azure Managed Disks"><meta property="og:description" content="This article gives an in-depth guide to Azure Managed Disks."><meta property="og:type" content="article"><meta property="og:url" content="https://radirobi97.github.io/personal-website/posts/azure-disk/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-01-11T00:00:00+00:00"><meta property="og:see_also" content="https://radirobi97.github.io/personal-website/posts/kubernetes-service-account/"><title>Everything you should know about Azure Managed Disks · robertradi</title><link rel=canonical href=https://radirobi97.github.io/personal-website/posts/azure-disk/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/personal-website/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/personal-website/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/personal-website/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/personal-website/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/personal-website/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/personal-website/images/apple-touch-icon.png><meta name=generator content="Hugo 0.99.1"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/personal-website>robertradi</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/personal-website/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/personal-website/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/personal-website/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/personal-website/contact/>Contact me</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://radirobi97.github.io/personal-website/pt-br/>HU</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://radirobi97.github.io/personal-website/posts/azure-disk/>Everything you should know about Azure Managed Disks</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-01-11T00:00:00Z>January 11, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
7-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/personal-website/categories/azure/>azure</a>
<span class=separator>•</span>
<a href=/personal-website/categories/in-depth/>in-depth</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/personal-website/tags/azure/>azure</a></span>
<span class=separator>•</span>
<span class=tag><a href=/personal-website/tags/disk/>disk</a></span></div></div></header><div><p>One way to store data in Azure is using Azure Managed disks. Furthermore, disks will host your operating system. In this article, I am trying to give an in-depth look into Azure Disks.</p><h2 id=basics>Basics
<a class=heading-link href=#basics><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li>disks are independent first-class resources, meaning they can live on their own. This was not always the case, because at the beginning disks were a part of storage accounts. So, limits of storage accounts had to be taken into consideration. To be completely correct, that is the case today as well, however it is abstracted from the end-customers. If you want to explore this, visit one of your disks, and choose disk export. The domain indicates that this is a storage account indeed under-the-hood.<figure><img src=images/disk_export.png><figcaption><h4>Disk Export</h4></figcaption></figure></li><li>disks can take the advantage of using RBAC</li><li>snapshot can be taken to provide consistent backups. These snapshots can be incremental or full.</li><li>disks have their own limits for IOPS, throughput</li><li>in Azure we always have to pay for the provisioned size and not for the used one</li><li>disk size can not be decreased</li></ul><h2 id=characteristics-of-managed-disks>Characteristics of managed disks
<a class=heading-link href=#characteristics-of-managed-disks><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li><strong>capacity</strong>: how much data can be stored on the disk. This size is defined in mebi-, gibi-, tebibytes, meaning we have to multiply the things by 1024.</li><li><strong>IOPS</strong>: Input Output Operations per Second, the number of input/output operations the disk can handle within one second. Every IO operand has its own size, that is the IO depth. More IO operands with a smaller IO depth is causing much more load then fewer IO operands with a larger IO depth. That is because every IO operand has its own overhead and the CPU should manage those. If we want to move a lot of small files then large IOPS is required. A good example for this is an OLTP application.</li><li><strong>throughput</strong>: bandwidth is an alias. It defines the amount of data can be sent to the disk within one second. The relations ship between IOPS and throughput is the followin: <code>throughput = IOPS * IO_depth</code>. If we want to move a small large files then the throughput is critical. For example a data warehouse.</li><li><strong>latency</strong>: the time it takes to get a response from the disk for the given request. Most of the time read and write latency differs. The IO metric is useless without knowing the latency. Latency is critical for streaming applications.</li></ul><h2 id=key-indicators-we-should-take-into-consideration-before-choosing-a-disk-sku>Key indicators we should take into consideration before choosing a disk SKU
<a class=heading-link href=#key-indicators-we-should-take-into-consideration-before-choosing-a-disk-sku><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li>How much data should be stored?</li><li>What is the required latency?</li><li>What are the average IO and throughput required by the application?</li><li>What are the peak values?<ul><li>What are the exact values of these peaks?</li><li>How long do they last?</li><li>How often do they occur?</li></ul></li></ul><h2 id=disk-types>Disk types
<a class=heading-link href=#disk-types><i class="fa fa-link" aria-hidden=true></i></a></h2><ol><li>Standard HDD<ul><li>Performance is not guaranteed, we have only an &ldquo;upto&rdquo; value</li><li>Only locally redundant storage (LRS) is supported. LRS means we have 3 copies of the data.</li><li>Performance can be increased only by increasing the disk size</li></ul></li><li>Standard SSD<ul><li>Performance is not guaranteed, we have only an &ldquo;upto&rdquo; value</li><li>Zone redundant storage (ZRS), LRS are supported. Zone redundant means that we have 3 copies of the data and each copy is stored in a different avaibility zone.</li><li>Credit based bursting is available for free for IOPS and throughput</li><li>Performance can be increased only by increasing the disk size</li></ul></li><li>Premium SSD<ul><li>Performance is guaranteed</li><li>ZRS, LRS are supported</li><li>This is where enterprise grade disks begin</li><li>Performance tier can be increased <strong>online (no need for detaching the disk from the VM)</strong> without having to increase the disk size. Increasing the performance tier takes up to max 1 hour to take effect. We will be charged based on the following formula: <code>cost = max(PerformanceTIER, SizeTIER)</code>. Performance tier can be decreased as well.</li><li>Under P30 tier credit based bursting is available. Above that we can take advantage of ondemand bursting which is <strong>not free</strong>.</li><li>They can be used as a shared disk, meaning a given disk can be attached to multiple VM at the same time.</li></ul></li><li>Ultra disk<ul><li>Performance is guaranteed</li><li>ZRS, LRS are supported</li><li>IOPS and throughput can be finetuned separately</li><li>They can be used as a shared disk.</li><li>Ultra disk is a good choice for database storage.</li></ul></li></ol><h1 id=disk-skus-and-vm-skus>Disk SKUs and VM SKUs
<a class=heading-link href=#disk-skus-and-vm-skus><i class="fa fa-link" aria-hidden=true></i></a></h1><p>Every type of disks has its own SKU. This SKU defines the capabilities and limits of a given disk. You can see one example on the following pictuce.
<img src=/images/disk_sku.png alt=disk-sku>
Some explanations to the attributes:</p><ul><li>*<em>Disk Size</em>: how much data can be stored on the disk</li><li><strong>Price per month</strong>: the monthly price of the disk</li><li><strong>Max IOPS (Max IOPS w/ bursting)</strong>: How many IOPS the disk can offer with and without bursing. Bursting discussed at a later section of this post.</li><li><strong>Max throughput (Max throughput w/ bursting)</strong>: How much throughput the dis can offer with and without bursting.</li><li><strong>Price per mount per month (Shared Disk)</strong>: Premium SSD and ultra disks can be attached to multiple VMs at the same time. We will pay this amount of money for each mount.</li></ul><p>It is important to know that not only the disks but each VMs has its own limits and values for IOPS and throughput as well:
<img src=/images/vm_sku.png alt=vm-sku>
A powerful disk is not worth anything without a proper VM. We should differentiate two different scenarios:</p><ul><li>When the VM could handle more IOPS/throughput than the disk can offer: we can say that the workload is IO/throughput capped on the disk level.</li><li>When the disk offers more IOPS/throughput than the VM can handle: we can say that the workload is IO/throughput capped on the VM level.
If we are working with network based storage, the network limits of the VM should be taken into consideration.</li></ul><h1 id=host-cache>Host cache
<a class=heading-link href=#host-cache><i class="fa fa-link" aria-hidden=true></i></a></h1><p>Probably you have noticed on the previous picture that there is something called a cached or uncached IOPS/throughput. This has to do with the feature called &ldquo;host caching&rdquo;. When you attach a disk to the VM, you have the option to define whether to use host caching on that particular disk.
<img src=/images/host_cache.png alt=host-cache>
Host cache is all about bringing the data closer to the VM to be able to perform the reads, writes quicker. The documentation of every VM states how large this host cache could be.</p><p>There are different types of host caching.</p><ul><li><strong>None</strong>: no caching at all. Configure host-cache as None for write-only and write-heavy disks, for example when writing a huge amount of logs.</li><li><strong>read-only</strong>: reads are server from the cache. Use this for read heavy workloads.</li><li><strong>read/write</strong>: reads are served from the cache, and writes propagates to the disk asyncronously. Use only if your application properly handles writing cached data to persistent disks when needed. If the app does not handle it properly that could lead to data loss when the VM crashes.</li></ul><p>But what is cached IOPS and uncached IOPS? For the sake of simplicity we will discuss IOPS but the same applies for throughput as well. How each IO operation count into these limits?</p><h5 id=using-read-only-host-cache>using read only host cache
<a class=heading-link href=#using-read-only-host-cache><i class="fa fa-link" aria-hidden=true></i></a></h5><p><img src=/images/host_cache_limits.png alt=host-cache-limit></p><ul><li>First of all lets take a read operation. If the data is present in the cache then it will be read from the cache. It will count into cached limits of the VM. This is illustrated on the above picture by black arrows. If the data is not present in the cache, then first the data will be read from the disk into cache, and after that from the cache into the VM. So, this operation counts into the cached limits and into the uncached limits as well.</li><li>What about a write operation? It will also count into both of the limits due to the data first will be written into the cache, and after that from the cach into the disk.</li></ul><h5 id=using-readwrite-host-cache>using read/write host cache
<a class=heading-link href=#using-readwrite-host-cache><i class="fa fa-link" aria-hidden=true></i></a></h5><ul><li>read operations are performed the same way just like using a read only cache</li><li>write operations are different. The given write operation is marked as done when the data has been written to the cache, this counts into the cached limits. The data will be written into the disk asyncronously, and this counts into the uncached limits</li></ul></div><footer><section class=see-also><h3 id=see-also-in-themes-guide>See also in Themes Guide
<a class=heading-link href=#see-also-in-themes-guide><i class="fa fa-link" aria-hidden=true></i></a></h3><nav><ul><li><a href=/personal-website/posts/kubernetes-service-account/>Kubernetes Service Account and their tokens</a></li></ul></nav></section></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2022
Robert Radi
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/personal-website/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script></body></html>